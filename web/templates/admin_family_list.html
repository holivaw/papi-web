{% extends 'common_cards_container.html' %}
{% from 'macros.j2' import tooltip_attributes, event_visibility_icon, screen_type_icon %}

{% block cards_container_title %}
    {{ event_visibility_icon(admin_event, '') }}
    {{ admin_event.name }} - Familles d'écrans
{% endblock %}

{% block cards_container_right_buttons %}
    {% for screen_type, family_data in {
        'input': {
            'title': 'Saisie des résultats',
            'checkbox_tooltip_text': 'Cacher ou montrer les familles d\'écrans de saisie des résultats.',
            'icon_class': 'bi-pencil-fill',
        },
        'boards': {
            'title': 'Affichage des échiquiers',
            'checkbox_tooltip_text': 'Cacher ou montrer les familles d\'écrans d\'affichage des échiquiers.',
            'icon_class': 'bi-card-list',
        },
        'players': {
            'title': 'Affichage des appariements',
            'checkbox_tooltip_text': 'Cacher ou montrer les familles d\'écrans d\'affichage des appariements.',
            'icon_class': 'bi-people-fill',
        },
    }.items() %}
        {% with id='show-'~screen_type~'-families-on-family-list', name='show_'~screen_type~'_families_on_family_list' %}
            <div
                    class="form-check form-switch d-inline-block pe-3 mt-2"
                    {{ tooltip_attributes('info', family_data.checkbox_tooltip_text, 'top') }}
            >
                <input
                        name="{{ name }}"
                        hx-post="{{ url_for('admin-update-header') }}"
                        hx-vals='{"admin_main_selector": "{{ admin_event.uniq_id }}", "admin_event_selector": "@families", "{{ name }}": "{% if screen_type in screen_types_on_family_list %}off{% else %}on{% endif %}"}'
                        hx-swap="multi:#admin-header,#admin-content"
                        hx-indicator="#please-wait"
                        class="form-check-input"
                        type="checkbox"
                        id="{{ id }}"
                        {% if screen_type in screen_types_on_family_list %}checked{% endif %} />
                <label for="{{ id }}" class="form-check-label">
                    {{ screen_type_icon(screen_type) }}
                </label>
            </div>
        {% endwith %}
    {% endfor %}
    {% with id='show-details-on-family-list', name='show_details_on_family_list' %}
        <div
                class="form-check form-switch d-inline-block pe-3 mt-2"
                {{ tooltip_attributes('info', 'Activer ou désactiver l\'affichage des détails sur les cartes des familles d\'écrans ci-dessous.', 'top') }}
        >
            <input
                    name="{{ name }}"
                    hx-post="{{ url_for('admin-update-header') }}"
                    hx-vals='{"admin_main_selector": "{{ admin_event.uniq_id }}", "admin_event_selector": "@families", "{{ name }}": "{% if show_details_on_family_list %}off{% else %}on{% endif %}"}'
                    hx-swap="multi:#admin-header,#admin-content"
                    hx-indicator="#please-wait"
                    class="form-check-input"
                    type="checkbox"
                    id="{{ id }}"
                    {% if show_details_on_family_list %}checked{% endif %} /><label for="{{ id }}" class="form-check-label"> Détails</label>
        </div>
    {% endwith %}
    <span {{ tooltip_attributes('info', 'Rafraîchir cet onglet.', 'top') }}>
        <button
                class="btn btn-primary text-nowrap me-2"
                hx-post="{{ url_for('admin-update-header') }}"
                hx-vals='{"admin_main_selector": "{{ admin_event.uniq_id }}", "admin_event_selector": "@families"}'
                hx-swap="multi:#admin-header,#admin-content"
                hx-indicator="#please-wait"
        >
            <i class="bi-arrow-clockwise"></i>
        </button>
    </span>
    <span {{ tooltip_attributes('info', 'Ajouter une nouvelle famille d\'écrans à l\'évènement.' if admin_event.tournaments_by_id else 'Vous devez créer un tournoi avant de pouvoir créer des familles d\'écrans', 'top') }}>
        <button
                class="btn btn-primary text-nowrap"
                hx-post="{{ url_for('admin-family-render-edit-modal') }}"
                hx-vals='{"action": "create", "admin_event_uniq_id": "{{ admin_event.uniq_id }}"}'
                hx-target="#admin-modal-container"
                hx-swap="innerHTML"
                data-bs-toggle="modal"
                data-bs-target="#admin-modal-container"
                hx-indicator="#please-wait"
                {% if not admin_event.tournaments_by_id %}
                    disabled
                {% endif %}
        >
            <i class="bi-plus-square-fill"></i> Créer une famille
        </button>
    </span>
{% endblock %}

{% block cards_container_cards %}
    <div class="row">
        {% set ns = namespace(screen_found=false) %}
        {% for family in admin_event.families_by_id.values() %}
            {% if family.type in screen_types_on_family_list %}
                {% set ns.family_found=true %}
                {% with card_class='bg-info-subtle' %}
                    {% include 'admin_family_card.html' %}
                {% endwith %}
            {% endif %}
        {% endfor %}
        {% if not ns.family_found %}
            <div class="col-12">
                Aucune famille d'écrans trouvée.
            </div>
        {% endif %}
    </div>
{% endblock %}
